# Defensive Programming vs Let It Crash

Когда вся программа выполняется в одном потоке, аварийное завершение этого потока означает аварийное завершение программы. И если это случилось в месте, где явно не предусмотрена обработка ошибок, то остается минимум информации для диагностики проблемы.

Поэтому программисты стараются предусмотреть обработку всех возможных ошибок во всех возможных местах. Такой стиль программирования называется **Defensive Programming**. И он может привести к тому, что программа содержит больше кода для обработки ошибок, чем кода, выполняющего основную задачу. Конечно, это усложняет и написание кода, и поддержку.

Эликсир предлагает другой подход: реализовать только основную задачу (**happy path**) и не писать код для обработки ошибок. Благодаря многопоточности и разделению ролей между **рабочими потоками** и **супервизорами**, любая ошибка всегда будет обработана и записана в лог. А система в целом продолжит работу. Этот подход называется **Let It Crash**.

На практике обычно сочетаются оба подхода -- и в Эликсир, и в других языках.

В однопоточной программе нельзя реализовать Let it Crash. Но там, где важно стабильная работа такой программы она контролируются снаружи на уровне операционной системы. Или ещё выше уровнем -- в облачной платформе. Всем нам знаком кубернетис, который реализует Let It Crash для любого сервиса.

Мы можем оценить, насколько часто применяется обработка исключений в разных языках.

Популярный веб-сервер **Cowboy**, написаный на Эрланг, имеет 25К строк кода и 23К строк тестов. На весь этот код исключения применяются около 180 раз. (Данные для версии 2.6.3 суммарно по трем библиотекам: cowboy, cowlib и ranch). То есть, одно исключение на 260 строк кода.

А популярная Эликсир библиотека для работы с базами данных -- **Ecto** (версия 3.3.2) на 28К строк кода применяет исключения 300 раз. Одно исключение на 90 строк кода.

Для сравнения возьмем язык Python, где применение исключенией для управления потоком выполнения является нормальной практикой. Фреймворк **Django** версии 3.2 на 376К строк кода применяет исключения 20К раз. Одно исключение на 20 строк кода.
